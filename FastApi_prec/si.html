<!doctype html>
    <html>
      <head>
        <meta charset="utf-8"/>
        <title>Smart Inventory — Demo</title>
        <style>
          body{font-family: Arial; max-width:900px;margin:30px}
          input,button{padding:8px;margin:4px}
          .card{border:1px solid #ddd;padding:10px;margin:6px;border-radius:6px}
        </style>
      </head>
      <body>
        <h1>Smart Inventory — Demo</h1>

        <h2>Create product</h2>
        <form id="createForm">
          SKU: <input name="sku" required /> 
          Name: <input name="name" required />
          Price: <input name="price" required type="number" step="0.01" />
          <button type="submit">Create</button>
        </form>

        <h2>Search (autocomplete)</h2>
        <input id="q" placeholder="type product name..." />
        <ul id="hits"></ul>

        <h2>Products</h2>
        <div id="list"></div>

        <script>
          async function loadList(){
            const res = await fetch('/api/products');
            const json = await res.json();
            const list = document.getElementById('list');
            list.innerHTML = '';
            json.forEach(p=>{
              const div = document.createElement('div');
              div.className='card';
              div.innerHTML = `<b>${p.name}</b> (SKU: ${p.sku}) — ₹${p.price}<br>${p.description||''}`;
              list.appendChild(div);
            });
          }
          document.getElementById('createForm').addEventListener('submit', async (e)=>{
            e.preventDefault();
            const fd = new FormData(e.target);
            const body = {
              sku: fd.get('sku'),
              name: fd.get('name'),
              price: parseFloat(fd.get('price')),
            };
            const resp = await fetch('/api/products', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
            if(resp.ok){ loadList(); e.target.reset(); alert('Created') } else { alert('Create failed') }
          });

          const qin = document.getElementById('q');
          const hits = document.getElementById('hits');
          qin.addEventListener('input', async ()=>{
            const q = qin.value.trim();
            hits.innerHTML = '';
            if(!q) return;
            const r = await fetch('/api/autocomplete?q='+encodeURIComponent(q));
            const j = await r.json();
            for(const id of j.ids){
              const li=document.createElement('li');
              // fetch product to show name
              const pr = await fetch('/api/products/'+id);
              if(pr.ok){
                const pd = await pr.json();
                li.textContent = pd.name + ' (SKU: '+pd.sku+')';
              } else {
                li.textContent = 'id:'+id;
              }
              hits.appendChild(li);
            }
          });

          // load list on page open
          loadList();
        </script>
      </body>
    </html>